# 해결된 이슈 목록

## 1. 통화 상태 유지 문제 (2024-06)

### 이슈 내용
- 앱이 통화 중 종료되거나 강제 종료된 후 재시작되면 통화 화면이 제대로 표시되지 않는 문제
- 특수 전화번호(1644 등)로 통화 시 백그라운드 서비스와 UI 간 통화 상태 동기화 불일
- 통화 타이머가 초기화되거나 정상 작동하지 않는 문제

### 해결 방법
1. **통화 상태 캐싱 메커니즘 개선**
   - 백그라운드 서비스에서 통화 상태를 캐싱하여 앱 재시작 시에도 복원 가능하도록 구현
   - `_cachedCallActive`, `_cachedCallNumber`, `_cachedCallerName` 변수를 통해 통화 상태 보존
   - `performInitialBackgroundTasks()` 함수에서 초기 통화 상태 확인 및 캐싱 로직 추가

2. **백그라운드-UI 통신 개선**
   - UI 초기화 완료 시 `appInitialized` 이벤트를 백그라운드 서비스에 전달
   - HomeScreen의 `_checkCachedCallState()` 함수에서 캐싱된 통화 상태 요청
   - 백그라운드 서비스의 `checkCachedCallState` 리스너에서 캐싱된 상태를 UI에 전달

3. **특수 번호 처리 개선**
   - 1644와 같은 특수 전화번호 통화 시에도 상태를 정확히 추적하는 로직 추가
   - `responseCurrentCallStateToBackgroundForTimer` 통신 채널 추가
   - 타이머 시작 로직 강화 및 로깅 개선

4. **로깅 강화**
   - 통화 상태 변화 및 타이머 작동 시점에 상세 로그 추가
   - 백그라운드 서비스 시작 및 UI 초기화 과정에 디버깅 로그 강화

### 결과
- 앱이 강제 종료된 후에도 재시작 시 통화 상태가 정확히 복원됨
- 통화 타이머가 지속적으로 작동하며 UI에 정확한 통화 시간 표시
- 다양한 상황에서의 통화 상태 동기화 안정성 개선

## 2. 노티피케이션 관련 문제 (2024-06)

### 이슈 내용
- 서버에서 노티피케이션을 삭제해도 앱에서는 계속 표시되는 문제
- 백그라운드 서비스에서 GraphQL API 직접 호출 시 인증 토큰 문제
- 만료 타임스탬프(validUntil) 처리 오류로 만료된 노티피케이션이 삭제되지 않는 문제

### 해결 방법
1. **서버-로컬 동기화 메커니즘 개선**
   - 서버의 노티피케이션 목록과 로컬 목록을 동기화하는 `syncWithServerIds` 메서드 추가
   - 백그라운드 서비스에서 서버 노티피케이션 ID 목록 추출 및 메인 isolate에 동기화 요청
   - 서버에 없는 노티피케이션은 로컬에서 자동 삭제되도록 구현

2. **API 호출 방식 변경**
   - 백그라운드 서비스에서 직접 API 호출 대신 메인 isolate에 메시지 전달 방식으로 변경
   - `requestNotifications` 메시지 처리 리스너 구현
   - 메인 isolate에서 인증된 상태로 API 호출 후 결과를 백그라운드 서비스에 전달

3. **타임스탬프 처리 개선**
   - validUntil 값이 String으로 저장된 경우 정수로 변환하는 로직 추가
   - 여러 형식(ISO 문자열, 숫자 문자열, 정수)의 타임스탬프를 올바르게 처리하는 로직 구현
   - 저장 시 항상 int 타입으로 통일하여 일관성 유지

4. **UI 개선**
   - 노티피케이션 삭제 기능 추가 (스와이프 및 삭제 버튼)
   - 노티피케이션 다이얼로그 열 때 서버에서 최신 데이터 요청
   - 이벤트 버스를 통한 홈 화면 노티피케이션 카운트 실시간 업데이트

### 결과
- 서버에서 노티피케이션 삭제 시 앱에서도 즉시 반영됨
- 만료된 노티피케이션이 자동으로 삭제됨
- 사용자가 직접 노티피케이션을 관리할 수 있게 됨
- 메모리 누수 및 캐시 관련 문제 해결

## 기타 개선 사항
- 코드 가독성 향상을 위한 주석 추가 및 구조화
- 예외 처리 및 오류 로깅 강화
- Repository 패턴을 통한 데이터 접근 일관성 확보
- 백그라운드 서비스와 메인 앱 간 통신 안정성 개선 